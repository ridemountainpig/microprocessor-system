//
// LCD_Bmp : display Logo Bitmap on LCD
//
// Bitmap Creation:
// Step 1. use Paint to draw 128x64 bitmap
// Step 2. use bmp2asm to convert bitmap into hex
// Step 3. cut hex code paste into char array Bitmap[128*8]
// Step 4. build & download code to learning board, then bitmap will be
// displayed on LCD
//
#include <stdio.h>

#include "LCD.h"
#include "MCU_init.h"
#include "NUC100Series.h"
#include "SYS_init.h"
#include "Scankey.h"

unsigned char img1[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xF8, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE,
    0xFE, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0xF8, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x03, 0x07, 0x0F, 0x1F, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F,
    0x1F, 0x0F, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

unsigned char img2[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x10, 0x38, 0x7C, 0xFE, 0xFF, 0xFE, 0xFC, 0xF8, 0xF0,
    0xC0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFF, 0xFE, 0x7C, 0x38, 0x10, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0xC0, 0xE0, 0xF0, 0xF9, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0xFF, 0xFF, 0xFF,
    0xFF, 0xF9, 0xF0, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F,
    0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x07, 0x03,
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

};

unsigned char img3[] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xC0, 0xC0, 0xC0,
    0xE0, 0xE0, 0xFC, 0xFF, 0xFC, 0xE0, 0xE0, 0xC0, 0xC0, 0xC0, 0x40, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x71, 0x3F, 0x3F, 0x1F, 0x1F,
    0x1F, 0x3F, 0x3F, 0x71, 0x80, 0x00, 0x00, 0x00};

int keyin;
int stack[3] = {0, 0, 0};
int i, j;
int check;
int place;
int stackLength = 0;

int main(void) {
  SYS_Init();

  init_LCD();
  clear_LCD();

  PD14 = 0;

  while (1) {
    keyin = ScanKey();
    CLK_SysTickDelay(500000);
    if (keyin == 1) {
      check = 0;
      place = -1;
      for (i = 0; i < stackLength; i++) {
        if (stack[i] == 1) {
          check = 1;
          place = i;
        }
      }
      if (!check) {
        draw_Bmp32x32(50, 30, FG_COLOR, BG_COLOR, img1);
        stack[stackLength] = 1;
        stackLength++;
      }

      if (place + 1 == stackLength) {
        stack[stackLength] = 0;
        stackLength--;
        clear_LCD();
        for (i = 0; i < stackLength; i++) {
          if (stack[i] == 2) {
            draw_Bmp32x32(40, 20, FG_COLOR, BG_COLOR, img2);
          } else if (stack[i] == 3) {
            draw_Bmp32x32(20, 10, FG_COLOR, BG_COLOR, img3);
          }
        }
      }
    }
    if (keyin == 2) {
      check = 0;
      place = -1;
      for (i = 0; i < stackLength; i++) {
        if (stack[i] == 2) {
          check = 1;
          place = i;
        }
      }
      if (!check) {
        draw_Bmp32x32(40, 20, FG_COLOR, BG_COLOR, img2);
        stack[stackLength] = 2;
        stackLength++;
      }

      if (place + 1 == stackLength) {
        stack[stackLength] = 0;
        stackLength--;
        clear_LCD();
        for (i = 0; i < stackLength; i++) {
          if (stack[i] == 1) {
            draw_Bmp32x32(50, 30, FG_COLOR, BG_COLOR, img1);
          } else if (stack[i] == 3) {
            draw_Bmp32x32(20, 10, FG_COLOR, BG_COLOR, img3);
          }
        }
      }
      // draw_Bmp32x32(40,20,FG_COLOR,BG_COLOR,img2);
    }
    if (keyin == 3) {
      check = 0;
      place = -1;
      for (i = 0; i < stackLength; i++) {
        if (stack[i] == 3) {
          check = 1;
          place = i;
        }
      }
      if (!check) {
        draw_Bmp32x32(20, 10, FG_COLOR, BG_COLOR, img3);
        stack[stackLength] = 3;
        stackLength++;
      }

      if (place + 1 == stackLength) {
        stack[stackLength] = 0;
        stackLength--;
        clear_LCD();
        for (i = 0; i < stackLength; i++) {
          if (stack[i] == 1) {
            draw_Bmp32x32(50, 30, FG_COLOR, BG_COLOR, img1);
          } else if (stack[i] == 2) {
            draw_Bmp32x32(40, 20, FG_COLOR, BG_COLOR, img2);
          }
        }
      }
      // draw_Bmp32x32(20,10,FG_COLOR,BG_COLOR,img3);
    }
  }
}
